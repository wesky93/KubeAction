name: slack-notiy
on: 
    watch:
      types: [started]
jobs:
  authorize:
    runs-on: ubuntu-latest
    steps:
    - uses: octokit/request-action@v2.0.0
      with:
        route: GET /repos/:repository/collaborators/${{ github.actor }}
        repository: ${{ github.repository }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  refresh-feed:
    runs-on: ubuntu-latest
    steps:
      - name: Get Error Server ğŸ“¦
        id: getDoamin
        uses: JamesIves/fetch-api-data-action@releases/v1
        with:
          ENDPOINT: http://console-api.dev.pyengine.net
          CONFIGURATION: '{ "method": "POST" }'
      - id: result
        uses: gr2m/get-json-paths-action@v1.x
        with:
          json: ${{ steps.getDoamin.outputs.response }}
          first_id: "results[0].domain_id"
          first_name: "results[0].name"
          total: "total_count"
      - uses: rtCamp/action-slack-notify@v2.0.2
        env:
          SLACK_CHANNEL: '#front-end'
          SLACK_COLOR: '#6638B6'
          SLACK_ICON: https://spaceone.console.dev.spaceone.dev/img/brand_logo.c3ef8139.png
          SLACK_MESSAGE: 'ì´ ${{ steps.result.outputs.total }}ê°œì˜ ë„ë©”ì¸ì´ ìˆì–´ìš”! \nì²«ë²ˆì§¸ ë„ë©”ì¸ ì•„ì´ë””ëŠ” ${{ steps.result.outputs.first_id }}ì´êµ¬\nì´ë¦„ì€ ${{ steps.result.outputs.first_name }}ì´ì—ìš”!'
          SLACK_USERNAME: ì›ì´ê°€ ì•Œë ¤ë“œë¦¼
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
